# **Sandboxed**

## الترجمة الحرفية  
**Sandboxed** — **مُشغَّل داخل صندوق حماية (Sandbox)** بحدود وصلاحيات مُقيَّدة.

## الوصف العربي المختصر  
تشغيل كود/تطبيق داخل **بيئة مقيّدة** بسياسات أمان (ملفات، شبكة، ذواكر، نداءات نظام) لمنع تأثيره على بقية النظام.  
تُستخدم في المتصفّحات، أنظمة الهاتف، الحاويات، والوظائف السحابية لتنفيذ آمن ومعزول.

## الشرح المبسّط  
- **أقلّ صلاحيات ممكنة**: لا يرى إلا ما يحتاجه.  
- **قيود صارمة**: منع نداءات نظام خطِرة (seccomp)، قطع الشبكة، ملفات للقراءة فقط.  
- **حدود موارد**: CPU/ذاكرة/عدد العمليات.  
- **أسوار متعددة**: أسماء/مساحات ملفات وشبكات مستقلّة (namespaces).  
- **لو تعطّل** لا يجرّ معه النظام؛ الضرر يبقى داخل “الصندوق”.

## تشبيه  
مثل **صندوق رمل** في الحديقة: الأطفال يلعبون داخله بأدوات محدودة، والجدران تمنع خروج الرمل وتمنع الفوضى في كل الحديقة.  
البرنامج “يلعب” داخل حدوده دون تخريب البيت كله.

## مثال CLI قصير (تشغيل تطبيق داخل صندوق عبر Docker)
```bash
docker run --rm \
  --read-only \                 # نظام ملفات للقراءة فقط
  --pids-limit 128 \            # حد أقصى للعمليات
  --cpus 0.5 --memory 256m \    # حدود CPU/RAM
  --cap-drop ALL \              # إسقاط كل القدرات الخاصة
  --security-opt no-new-privileges \  # منع تصعيد الصلاحيات
  --network none \              # بدون شبكة
  myapp:latest                  # الصورة/التطبيق
```
الإخراج المتوقع: تشغيل التطبيق ضمن قيود قوية؛ أي محاولة للكتابة على الجذر أو الخروج للشبكة تفشل.

## مثال HTML سطر واحد (صندوق في المتصفّح)
```html
<iframe src="/untrusted" sandbox="allow-scripts" referrerpolicy="no-referrer"></iframe>
```
الفكرة: الصفحة داخل الإطار لا تستطيع فتح نوافذ أو الوصول لـ APIs إلا المسموح بها صراحة.

## خطوات عملية لتطبيق Sandboxing
- شغّل الخدمات **كمستخدم غير إداري** (non-root) وأسقط القدرات غير الضرورية.  
- اجعل نظام الملفات **للقراءة فقط**، واسمح بمجلدات مؤقّتة معزولة عند الحاجة.  
- حدِّد الموارد: **CPU/RAM/PIDs**، وأغلق الشبكة إن لم تكن مطلوبة.  
- فعِّل سياسات نداءات النظام (مثل **seccomp**) و**AppArmor/SELinux** عند التوفر.  
- في المتصفّح: استخدم `iframe[sandbox]` و**CSP** و**Origin Isolation**.  
- في الهاتف: اطلب **أذونات دقيقة** فقط (Permissions) وفصّل البيانات حسب الحساب/المساحة.  
- أضف اختبارات تُثبت فشل العمليات المحظورة (كتابة خارج المسار/اتصال شبكي/تنفيذ فرعي).

## جدول مقارنة مختصر

| المفهوم | الغرض الرئيسي | ملاحظات مهمة |
|---|---|---|
| [Isolated](isolated.md) | فصل المكوّنات لتقليل التداخل | حدود واضحة (Process/Container/Network/Test) لكن ليست دائمًا مُنفَّذة بسياسات صارمة |
| **Sandboxed** | **تشغيل ضمن قيود أمنية مُنفَّذة** | **سياسات أمان تحدّ نداءات النظام/الملف/الشبكة**؛ مبدأ أقل صلاحيات |
| [Shared Environment](shared-environment.md) | مشاركة الموارد بين مكوّنات متعددة | إنتاجي وسهل لكن مخاطر تأثير متبادل وتسرب حالة أعلى |

## ملخص الفكرة  
**Sandboxed** = تشغيل مُقيَّد بسياسات أمان وحدود موارد تعزل التأثير وتمنع التصعيد.  
ابدأ بـ **أقل صلاحيات**، واجمع بين العزل المنطقي والسياسات التنفيذية لتحقيق حماية فعلية.
