# **Shared Environment**

## الترجمة الحرفية  
**Shared Environment** — **بيئة مُشتركة** (تتقاسمها عدّة تطبيقات/مستخدمين/خدمات).

## الوصف العربي المختصر  
تشغيل مكوّنات متعددة داخل **نفس النظام/الموارد**: ملفات، شبكة، ذاكرة، تبعيات، إعدادات.  
مريحة ورخيصة، لكنها تزيد **التأثير المتبادل** ومخاطر **التعارض** و**التسريب**.

## الشرح المبسّط  
- **تبعيات مشتركة:** نسخة حزمة واحدة قد تكسر تطبيقًا آخر.  
- **حالة مشتركة:** ملف/مجلّد/قاعدة بيانات واحدة للجميع.  
- **تنافس على الموارد:** CPU/RAM/مقابس الشبكة.  
- **أمان أضعف:** أي خلل قد يؤثر في بقية المكوّنات.

## تشبيه  
**سكان شقّة واحدة** يتشاركون المطبخ:  
لو أحدهم فوضوي، الكل يتأثر. الحل؟ قواعد واضحة، أرفف مُسمّاة، وأقفال عند الحاجة.

## مثال كود C# بسيط (تنسيق الوصول لملف مشترك عبر Mutex)
```csharp
using System;
using System.IO;
using System.Threading;

class Program
{
    static void Main()
    {
        // مسار مشترك على الجهاز (مثال)
        string sharedDir = Path.Combine(
            Environment.GetFolderPath(Environment.SpecialFolder.CommonApplicationData),
            "MyCompany", "SharedEnvDemo");
        Directory.CreateDirectory(sharedDir);

        string counterFile = Path.Combine(sharedDir, "counter.txt");

        // Mutex نظامي باسم عالمي لمنع السباق بين عمليات متعددة
        using var mutex = new Mutex(false, "Global\\SharedEnvDemo-Counter");
        mutex.WaitOne();
        try
        {
            int n = File.Exists(counterFile) ? int.Parse(File.ReadAllText(counterFile)) : 0;
            n++;
            File.WriteAllText(counterFile, n.ToString());
            Console.WriteLine($"Counter = {n}");
        }
        finally
        {
            mutex.ReleaseMutex();
        }
    }
}
```
الإخراج المتوقع:  
- كل تشغيل يزيد العداد بأمان حتى لو كانت هناك عمليات متعددة.  
- بدون الـ **Mutex** قد ترى قراءات/كتابات متعارضة (سباق Race Condition).

## خطوات عملية للتعامل مع البيئة المشتركة
- **أسمِ الموارد** وخصّص مسارات/جداول/مواضيع رسائل لكل تطبيق.  
- استخدم **قفلًا/Mutex** أو **قفل ملفات** أو **معاملات DB** لتجنب السباقات.  
- **ثبّت الإصدارات** (lock files) وجرّب في بيئة مرحلية قبل الإنتاج.  
- طبّق **Least Privilege** على الملفات/الخدمات.  
- راقب **الحصص** (CPU/RAM/IO) وسِجِلّات الاستخدام.  
- نظّف بقايا الملفات المؤقتة والاتصالات عند الإنهاء.

## متى أستخدمه؟ ومتى أتجنّبه؟
- **استخدمه** عندما يكون التشغيل السريع/التكلفة المنخفضة أهمّ من العزل (مختبرات تطوير/سيرفر تجميعي).  
- **تجنّبه** للتطبيقات الحسّاسة أمنيًا/أدائيًا؛ اختر **Isolated** أو **Sandboxed**.

## جدول مقارنة مختصر

| المفهوم                   | الغرض الرئيسي                             | ملاحظات مهمة                                    |
| ------------------------- | ----------------------------------------- | ----------------------------------------------- |
| [Isolated](isolated.md)   | فصل المكوّنات لتقليل التداخل               | حدود واضحة (Process/Container/Network/Test)     |
| **Shared Environment**    | **تشغيل سريع وتكلفة أقل بمشاركة الموارد** | **خطر تعارض/تسريب أعلى؛ يحتاج قواعد وضبط وصول** |
| [Sandboxed](sandboxed.md) | تشغيل ضمن قيود أمنية مُنفَّذة                | سياسات تحدّ نداءات النظام/الملف/الشبكة بصرامة    |

## ملخص الفكرة  
**Shared Environment** يسرّع البدء ويوفّر الموارد، لكنه يضيف مخاطر التداخل.  
ضع قواعد مشتركة، وفّر قفلًا/تسميات واضحة، وفكّر بالعزل أو الصنْدَقة عندما يرتفع الخطر.
