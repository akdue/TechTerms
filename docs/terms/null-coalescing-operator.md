# **Null-Coalescing Operator**

## معامل الدمج عند انعدام القيمة (`??`, `??=`)


## الترجمة الحرفية  
**Null-Coalescing Operator (`??`, `??=`)** — **معامل إرجاع قيمة بديلة عند `null`** (ومعاملة إسناد عند `null`).

## الوصف العربي المختصر  
`??` يُعيد **الطرف الأيسر إذا لم يكن null**، وإلّا يُعيد **الطرف الأيمن (قيمة بديلة)**.  
`??=` يُسند **قيمةً افتراضية** للمتغيّر **فقط إذا كان null**.

## الشرح المبسّط  
- لديك خياران: قيمة أساسية وقد تكون `null`، وقيمة احتياطية.  
- إن كانت الأساسية موجودة → نأخذها؛ إن كانت مفقودة (`null`) → نأخذ الاحتياط.  
- لا يُقيَّم الطرف الأيمن إذا كان الأيسر غير `null` (**Short-circuit**).  
- مناسب للـ **Defaults** وتهيئة الإعدادات والمخرجات الآمنة.

## تشبيه  
زرّان لتشغيل المصباح: الأوّل (المصدر الأساسي) والثاني احتياط.  
إذا كان الأوّل يعمل، لا حاجة للثاني. إذا تعطل الأوّل، نستخدم الاحتياط فورًا.

## مثال كود C# بسيط
```csharp
using System;

class Program
{
    static void Main()
    {
        string? name = null;

        // 1) ?? قيمة بديلة عندما تكون القيمة null
        string displayName = name ?? "Guest";
        Console.WriteLine(displayName); // Guest

        // 2) ?? مع أنواع Nullable
        int? maybeCount = null;
        int count = maybeCount ?? 0; // يعيد 0 إن كانت maybeCount = null

        // 3) الدمج مع المشغّل الشرطي-الآمن ?. لحماية السلاسل
        string?[]? items = null;
        int length = items?.Length ?? 0; // إن كانت items null يعيد 0

        // 4) ??= إسناد عند null (تهيئة كسولة)
        TimeSpan? timeout = null;
        timeout ??= TimeSpan.FromSeconds(30); // تُسند 30 ثانية فقط إذا كانت null
        Console.WriteLine(timeout);           // 00:00:30

        // 5) ?? مع تعبير throw (حراسة)
        string? conn = null;
        string normalized = (conn ?? throw new InvalidOperationException("Connection is required"))
                            .Trim();
    }
}
```
الإخراج المتوقع:  
- يطبع `Guest`، ثم `00:00:30`.  
- إذا كانت `conn` فارغة، يُرمى استثناء بوضوح (حراسة مبكرة).

## خطوات عملية لاستخدامه بفعالية
- استخدم `??` لإعطاء **قيمة افتراضية آمنة** عند قراءة مدخلات/إعدادات قد تكون `null`.  
- استخدم `??=` لتهيئة الحقول/الخصائص **مرة واحدة عند الحاجة** (Lazy init).  
- ادمجه مع `?.` لتقصير حراسة السلاسل: `user?.Address?.City ?? "N/A"`.  
- أضِف **أقواسًا** عند مزجه مع معاملات أخرى لتوضيح القراءة.  
- في نماذج الـ API: طبّق قيمًا افتراضية قبل التخزين أو التحقق.

## أخطاء شائعة
- نسيان أن `??` يعيد **قيمة** (تعبير)، وليس بديلًا عن منطق `if` متعدد الخطوات.  
- ترك **آثار جانبية** في الطرف الأيمن قد لا تُنفَّذ دائمًا (بسبب Short-circuit).  
- الخلط بينه وبين **المعامل الثلاثي**: `x ?? y` ليس مثل شروط مركّبة؛ هو فقط لفحص `null`.

## جدول مقارنة مختصر

| المفهوم | الغرض الرئيسي | ملاحظات مهمة |
|---|---|---|
| [Ternary Operator](ternary-operator.md) | اختيار قيمة بناءً على **شرط منطقي عام** | مرن لعدة شروط؛ قد يصبح معقدًا بالتعشيش |
| **Null-Coalescing Operator** | **تعيين/إرجاع بديل عند `null` فقط** | **قصير وآمن؛ يدعم `??=` للتهيئة عند `null`** |
| [Null-Conditional Operator](null-conditional-operator.md) | إيقاف السلسلة عند `null` بأمان (`?.`) | يُعيد `null` بدل الرمي؛ يُدمَج عادة مع `??` لقيمة افتراضية |

## ملخص الفكرة  
`??` و`??=` يقدّمان طريقة **نظيفة وآمنة** للتعامل مع `null`:  
أعطِ بديلًا سريعًا، وابدأ الحراسة مبكرًا، وقلّل من جمل `if` المتناثرة باستخدام تعابير موجزة واضحة.
